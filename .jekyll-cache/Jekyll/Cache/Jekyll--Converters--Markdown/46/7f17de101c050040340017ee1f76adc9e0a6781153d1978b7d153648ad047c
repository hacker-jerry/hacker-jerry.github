I"ê<h1 id="nodejs-å¼‚æ­¥ç¼–ç¨‹">Node.js å¼‚æ­¥ç¼–ç¨‹</h1>

<p>Node.js å¼‚æ­¥ç¼–ç¨‹çš„ç›´æ¥ä½“ç°å°±æ˜¯<strong>å›è°ƒ</strong>ã€‚å›è°ƒå‡½æ•°åœ¨å®Œæˆä»»åŠ¡åå°±ä¼šè¢«è°ƒç”¨ï¼ŒNode.js ä½¿ç”¨äº†å¤§é‡çš„å›è°ƒå‡½æ•°ï¼ŒNode.js æ‰€æœ‰ API éƒ½æ”¯æŒå›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°ä¸€èˆ¬ä½œä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°å‡ºç°ã€‚</p>

<h2 id="é˜»å¡ä»£ç ">é˜»å¡ä»£ç </h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">1.txt</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š
<img src="http://ww1.sinaimg.cn/large/007dh5vlly1g5c6kgip3yj30mm01iq2t.jpg" alt="" /></p>

<h2 id="éé˜»å¡ä»£ç ">éé˜»å¡ä»£ç </h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">1.txt</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">data</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š
<img src="http://ww1.sinaimg.cn/large/007dh5vlly1g5c6p84k91j30mr01l3ye.jpg" alt="" /></p>

<p>ç¬¬ä¸€ä¸ªå®ä¾‹åœ¨æ–‡ä»¶è¯»å–å®Œåæ‰æ‰§è¡Œå®Œç¨‹åºã€‚ ç¬¬äºŒä¸ªå®ä¾‹æˆ‘ä»¬ä¸éœ€è¦ç­‰å¾…æ–‡ä»¶è¯»å–å®Œï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¯»å–æ–‡ä»¶æ—¶åŒæ—¶æ‰§è¡Œæ¥ä¸‹æ¥çš„ä»£ç ï¼Œå¤§å¤§æé«˜äº†ç¨‹åºçš„æ€§èƒ½ã€‚</p>

<h2 id="å¼‚æ­¥æ‰“å¼€æ–‡ä»¶">å¼‚æ­¥æ‰“å¼€æ–‡ä»¶</h2>

<p><code class="highlighter-rouge">fs.open(path, flags[, mode], callback)</code></p>

<p>å‚æ•°è¯´æ˜ï¼š</p>

<ul>
  <li>
    <p>path:æ–‡ä»¶çš„è·¯å¾„</p>
  </li>
  <li>
    <p>flagsï¼šæ–‡ä»¶æ‰“å¼€çš„è¡Œä¸ºã€‚</p>
  </li>
  <li>
    <p>modeï¼šè®¾ç½®æ–‡ä»¶æ¨¡å¼(æƒé™)ï¼Œæ–‡ä»¶åˆ›å»ºé»˜è®¤æƒé™ä¸º 0o666ï¼ˆå¯è¯»å†™ï¼‰ã€‚mode è®¾ç½®æ–‡ä»¶æ¨¡å¼ï¼ˆæƒé™å’Œç²˜æ»ä½ï¼‰ï¼Œä½†ä»…é™äºåˆ›å»ºæ–‡ä»¶çš„æƒ…å†µã€‚åœ¨ Windows ä¸Šï¼Œåªèƒ½æ“ä½œå†™æƒé™ã€‚</p>
  </li>
  <li>
    <p>callbackï¼šå›è°ƒå‡½æ•°ï¼Œå¸¦æœ‰ä¸¤ä¸ªå‚æ•°å¦‚ï¼šcallback(err, fd)ã€‚</p>
  </li>
  <li>
    <p>flags å‚æ•°å¯ä»¥æ˜¯ä»¥ä¸‹å€¼ï¼š</p>
  </li>
</ul>

<blockquote>
  <p>â€˜aâ€™ - æ‰“å¼€æ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚</p>

  <p>â€˜axâ€™ - ä¸ â€˜aâ€™ ç›¸ä¼¼ï¼Œä½†å¦‚æœè·¯å¾„å­˜åœ¨åˆ™å¤±è´¥ã€‚</p>

  <p>â€˜a+â€™ - æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å–å’Œè¿½åŠ ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚</p>

  <p>â€˜ax+â€™ - ä¸ â€˜a+â€™ ç›¸ä¼¼ï¼Œä½†å¦‚æœè·¯å¾„å­˜åœ¨åˆ™å¤±è´¥ã€‚</p>

  <p>â€˜asâ€™ - ä»¥åŒæ­¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚</p>

  <p>â€˜as+â€™ - ä»¥åŒæ­¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å–å’Œè¿½åŠ ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚</p>

  <p>â€˜râ€™ - æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å–ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚</p>

  <p>â€˜r+â€™ - æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å–å’Œå†™å…¥ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚</p>

  <p>â€˜rs+â€™ - ä»¥åŒæ­¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å–å’Œå†™å…¥ã€‚æŒ‡ç¤ºæ“ä½œç³»ç»Ÿç»•å¼€æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ã€‚è¿™å¯¹äºåœ¨ NFS æŒ‚è½½ä¸Šæ‰“å¼€æ–‡ä»¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸è·³è¿‡å¯èƒ½è¿‡æ—¶çš„æœ¬åœ°ç¼“å­˜ã€‚ å®ƒå¯¹ I/O æ€§èƒ½æœ‰éå¸¸å®é™…çš„å½±å“ï¼Œå› æ­¤é™¤ééœ€è¦ï¼Œå¦åˆ™ä¸å»ºè®®ä½¿ç”¨æ­¤æ ‡å¿—ã€‚è¿™ä¸ä¼šå°† fs.open() æˆ– fsPromises.open() è½¬æ¢ä¸ºåŒæ­¥çš„é˜»å¡è°ƒç”¨ã€‚ å¦‚æœéœ€è¦åŒæ­¥æ“ä½œï¼Œåˆ™åº”ä½¿ç”¨ fs.openSync() ä¹‹ç±»çš„æ“ä½œã€‚</p>

  <p>â€˜wâ€™ - æ‰“å¼€æ–‡ä»¶ç”¨äºå†™å…¥ã€‚åˆ›å»ºæ–‡ä»¶ï¼ˆå¦‚æœå®ƒä¸å­˜åœ¨ï¼‰æˆ–æˆªæ–­æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</p>

  <p>â€˜wxâ€™ - ä¸ â€˜wâ€™ ç›¸ä¼¼ï¼Œä½†å¦‚æœè·¯å¾„å­˜åœ¨åˆ™å¤±è´¥ã€‚</p>

  <p>â€˜w+â€™ - æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å–å’Œå†™å…¥ã€‚åˆ›å»ºæ–‡ä»¶ï¼ˆå¦‚æœå®ƒä¸å­˜åœ¨ï¼‰æˆ–æˆªæ–­æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</p>

  <p>â€˜wx+â€™ - ä¸ â€˜w+â€™ ç›¸ä¼¼ï¼Œä½†å¦‚æœè·¯å¾„å­˜åœ¨åˆ™å¤±è´¥ã€‚</p>
</blockquote>

<h2 id="å¼‚æ­¥å…³é—­æ–‡ä»¶">å¼‚æ­¥å…³é—­æ–‡ä»¶</h2>

<p><code class="highlighter-rouge">fs.close(fd, callback)</code>
å‚æ•°è¯´æ˜ï¼š</p>

<ul>
  <li>
    <p>fdï¼šé€šè¿‡ fs.open() æ–¹æ³•è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p>
  </li>
  <li>
    <p>callbackï¼šå›è°ƒå‡½æ•°ï¼Œé™¤äº†å¯èƒ½çš„å¼‚å¸¸ï¼Œå®Œæˆå›è°ƒæ²¡æœ‰å…¶ä»–å‚æ•°ã€‚</p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// å¼‚æ­¥æ‰“å¼€æ–‡ä»¶</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">test.txt</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">r+</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">fd</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">æ–‡ä»¶æ‰“å¼€æˆåŠŸï¼</span><span class="dl">"</span><span class="p">);</span>
      <span class="c1">//å¼‚æ­¥å…³é—­æ–‡ä»¶</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="nx">fd</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span><span class="c1">//ç‰¹åˆ«æ³¨æ„ï¼šfs.closeæ˜¯åŒ…åœ¨fs.openä¸­å‚æ•°ä¹‹ä¸€çš„å›è°ƒå‡½æ•°ä¸­çš„ï¼Œè€Œä¸”å®ƒä»¬çš„å‚æ•°å½¢å¼ä¸åŒã€‚ fs.openæ˜¯æ–‡ä»¶è·¯å¾„å,fs.closeæ˜¯ä¼ å…¥çš„å›è°ƒå‡½æ•°çš„fdå‚æ•°ã€‚</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
         <span class="p">}</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">æ–‡ä»¶å…³é—­æˆåŠŸ</span><span class="dl">"</span><span class="p">);</span>
      <span class="p">});</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="è¯»å†™æ–‡ä»¶">è¯»å†™æ–‡ä»¶</h2>

<p>**å¼‚æ­¥è¯»å–æ–‡ä»¶çš„è¯­æ³•æ ¼å¼ä¸ºï¼š</p>

<p><code class="highlighter-rouge">fs.read(fd, buffer, offset, length, position, callback)</code></p>

<p>å‚æ•°è¯´æ˜ï¼š</p>

<ul>
  <li>
    <p>fd: é€šè¿‡ fs.open() æ–¹æ³•è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦ã€‚//ä¸èƒ½å˜æˆè·¯å¾„ï¼</p>
  </li>
  <li>buffer:æ˜¯æ•°æ®å†™å…¥çš„ç¼“å†²åŒºã€‚
    <blockquote>
      <p>é€šå¸¸ç”¨var buf= Buffer.alloc(1024)åˆ›å»º1024å­—èŠ‚çš„ç¼“å†²åŒºç„¶åä¼ å‚</p>
    </blockquote>
  </li>
  <li>
    <p>offset:æ˜¯ç¼“å†²åŒºä¸­å¼€å§‹å†™å…¥çš„åç§»é‡ã€‚ä¸€èˆ¬å®ƒçš„å€¼æˆ‘ä»¬å†™ä¸º 0ã€‚</p>
  </li>
  <li>
    <p>length:æ˜¯ä¸€ä¸ªæ•´æ•°ï¼ŒæŒ‡å®šè¦è¯»å–çš„å­—èŠ‚æ•°ã€‚</p>
  </li>
  <li>
    <p>position:æŒ‡å®šä»æ–‡ä»¶ä¸­å¼€å§‹è¯»å–çš„ä½ç½®ã€‚ å¦‚æœ position ä¸º nullï¼Œåˆ™ä»å½“å‰æ–‡ä»¶ä½ç½®è¯»å–æ•°æ®ï¼Œå¹¶æ›´æ–°æ–‡ä»¶ä½ç½®ã€‚</p>
  </li>
  <li>callback:å›è°ƒå‡½æ•°ï¼Œæœ‰ä¸‰ä¸ªå‚æ•° err, bytesRead, bufferã€‚err ä¸ºé”™è¯¯ä¿¡æ¯ï¼Œ bytesRead è¡¨ç¤ºè¯»å–çš„å­—èŠ‚æ•°ï¼Œbuffer ä¸ºç¼“å†²åŒºå¯¹è±¡ã€‚
<strong>ç¤ºä¾‹ï¼š</strong>
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// å¼‚æ­¥æ‰“å¼€æ–‡ä»¶</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">test.txt</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">r+</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">fd</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">æ–‡ä»¶æ‰“å¼€æˆåŠŸï¼</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">å‡†å¤‡è¯»å–æ–‡ä»¶ï¼š</span><span class="dl">"</span><span class="p">);</span>
  <span class="c1">// åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º 1024 å­—èŠ‚çš„ç¼“å­˜åŒº</span>
  <span class="kd">var</span> <span class="nx">buf</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">alloc</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>
  <span class="c1">// å¼‚æ­¥è¯»å–æ–‡ä»¶</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">fd</span><span class="p">,</span> <span class="nx">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">buf</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">,</span> <span class="nx">buf</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">bytes</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">å­—èŠ‚è¢«è¯»å–</span><span class="dl">"</span><span class="p">);</span>
      <span class="c1">// ä»…è¾“å‡ºè¯»å–çš„å­—èŠ‚</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">bytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">buf</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>
      <span class="p">}</span>
      <span class="c1">// å¼‚æ­¥å…³é—­æ–‡ä»¶</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="nx">fd</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">æ–‡ä»¶å…³é—­æˆåŠŸ</span><span class="dl">"</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p><strong>å¼‚æ­¥å†™å…¥æ–‡ä»¶çš„è¯­æ³•æ ¼å¼ä¸ºï¼š</strong></p>
  </li>
</ul>

<p><code class="highlighter-rouge">fs.write(fd, buffer, offset, length, position, callback)</code></p>

<p>å‚æ•°è¯´æ˜ï¼š</p>

<ul>
  <li>
    <p>fdï¼šä»æŒ‡å®šçš„æ–‡ä»¶å†™å…¥æ•°æ®ã€‚</p>
  </li>
  <li>
    <p>bufferï¼šæ˜¯æ•°æ®å†™å…¥çš„ç¼“å†²åŒºã€‚</p>
  </li>
  <li>
    <p>offsetï¼šæŒ‡å®šè¦å†™å…¥çš„ buffer éƒ¨åˆ†ã€‚</p>
  </li>
  <li>
    <p>lengthï¼šæ˜¯ä¸€ä¸ªæ•´æ•°ï¼ŒæŒ‡å®šè¦å†™å…¥çš„å­—èŠ‚æ•°ã€‚</p>
  </li>
  <li>
    <p>position æŒ‡å®šåº”è¯¥å†™å…¥æ­¤æ•°æ®çš„æ–‡ä»¶å¼€å¤´çš„åç§»é‡ã€‚ å¦‚æœ typeof position !== â€˜numberâ€™ï¼Œåˆ™ä»å½“å‰ä½ç½®å†™å…¥æ•°æ®ã€‚</p>
  </li>
  <li>callbackï¼šå›è°ƒæœ‰ä¸‰ä¸ªå‚æ•° (err, bytesWritten, buffer)ï¼Œå…¶ä¸­ bytesWritten æŒ‡å®šä» buffer å†™å…¥çš„å­—èŠ‚æ•°ã€‚
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// å¼‚æ­¥æ‰“å¼€æ–‡ä»¶</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">./test.txt</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">fd</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">æ–‡ä»¶æ‰“å¼€æˆåŠŸï¼</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">å‡†å¤‡å†™å…¥æ–‡ä»¶ï¼š</span><span class="dl">"</span><span class="p">);</span>
  <span class="c1">//æ–°å†™å…¥å†…å®¹ä¸º hello world</span>
  <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="dl">'</span><span class="s1"> hello world</span><span class="dl">'</span><span class="p">));</span>
  <span class="c1">// å¼‚æ­¥å†™å…¥æ–‡ä»¶</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">fd</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span><span class="c1">//0ï¼Œ12è¿™ä¸¤ä¸ªå‚æ•° ä¸€ä¸ªæ˜¯bufferå­—ç¬¦ä¸²ä½äºå¼€å¤´çš„åç§»é‡ ä¸€ä¸ªæ˜¯æ€»å…±è¦å†™å…¥çš„å­—ç¬¦æ•° å®ƒä»¬çš„å’Œ ä¸èƒ½è¶…è¿‡bufferçš„æ€»é•¿åº¦</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">å†™å…¥æˆåŠŸ</span><span class="dl">'</span><span class="p">);</span>
      <span class="c1">// æ‰“å°å‡ºbufferä¸­å­˜å…¥çš„æ•°æ®</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">bytes</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">å­—èŠ‚è¢«å†™å…¥</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>
      <span class="c1">// å¼‚æ­¥å…³é—­æ–‡ä»¶</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="nx">fd</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">æ–‡ä»¶å…³é—­æˆåŠŸ</span><span class="dl">"</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p>æˆ–
<code class="highlighter-rouge">fs.write(fd, string[, position[, encoding]], callback)</code>
å‚æ•°è¯´æ˜ï¼š</p>
  </li>
  <li>
    <p>fdï¼šä»æŒ‡å®šçš„æ–‡ä»¶å†™å…¥æ•°æ®ã€‚</p>
  </li>
  <li>
    <p>string:å†™å…¥çš„æ•°æ®ï¼Œå¦‚æœä¸æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¯¥å€¼å°†è¢«å¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p>
  </li>
  <li>
    <p>position æŒ‡å®šåº”è¯¥å†™å…¥æ­¤æ•°æ®çš„æ–‡ä»¶å¼€å¤´çš„åç§»é‡ã€‚ å¦‚æœ typeof position !== â€˜numberâ€™ï¼Œåˆ™ä»å½“å‰ä½ç½®å†™å…¥æ•°æ®ã€‚</p>
  </li>
  <li>
    <p>encodingï¼šæŒ‡å®šå­—ç¬¦ä¸²çš„ç¼–ç ï¼Œé»˜è®¤ä¸º â€˜utf8â€™ã€‚</p>
  </li>
  <li>callbackï¼šå›è°ƒæœ‰ä¸‰ä¸ªå‚æ•° (err, written, string)ï¼Œå…¶ä¸­ written æŒ‡å®šå­—ç¬¦ä¸²ä¸­å·²å†™å…¥æ–‡ä»¶çš„å­—èŠ‚æ•°ã€‚ å†™å…¥çš„å­—èŠ‚æ•°ä¸å­—ç¬¦ä¸²çš„å­—ç¬¦æ•°æ˜¯ä¸åŒçš„ã€‚
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">./1.txt</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">fd</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">fd</span><span class="p">,</span><span class="nx">data</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">bytes</span><span class="p">,</span><span class="nx">Buffer</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="nx">fd</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p>ä»¥ä¸Šæ–¹æ³•éƒ½æ˜¯åŸºäº<code class="highlighter-rouge">fs.open()å‡½æ•°</code>çš„ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ç®€å•ç²—æš´ç‚¹çš„å‡½æ•°å‘¢ï¼Ÿ
Yeapï¼
<code class="highlighter-rouge">fs.readFile(path,[options], callback)</code>é—ªäº®ç™»åœº
æ³•ä¸€ï¼š</p>
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">./1.txt</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">data</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p>æ³•äºŒï¼š</p>
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">./test.txt</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span><span class="c1">//åŠ ä¸Šç¼–ç æ–¹å¼</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p><code class="highlighter-rouge">fs.writeFile(file, data,[options], callback)</code>
å‚æ•°è¯´æ˜ï¼š</p>
  </li>
  <li>fileï¼šæ–‡ä»¶åæˆ–æ–‡ä»¶æè¿°ç¬¦ã€‚</li>
  <li>dataï¼šè¦å†™å…¥æ–‡ä»¶çš„æ•°æ®ï¼Œå¯ä»¥æ˜¯ String(å­—ç¬¦ä¸²) æˆ– Buffer(ç¼“å†²) å¯¹è±¡ã€‚</li>
  <li>optionsï¼šè¯¥å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« {encoding, mode, flag}ã€‚encoding é»˜è®¤å€¼ä¸ºï¼šâ€™utf8â€™, mode é»˜è®¤å€¼ä¸º 0o666 ï¼Œflag é»˜è®¤ä¸º â€˜wâ€™ã€‚</li>
  <li>callbackï¼šå›è°ƒå‡½æ•°ã€‚
ç¤ºä¾‹ï¼š
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// ä¼ é€’äº†è¿½åŠ å‚æ•° { 'flag': 'a' }</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">./test.txt</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">æˆ‘æ˜¯æ–°åŠ çš„å†…å®¹</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">flag</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Saved.</span><span class="dl">'</span><span class="p">);</span>
  <span class="c1">// å†™å…¥æˆåŠŸåè¯»å–æµ‹è¯•</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">./test.txt</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p>ä¸“é—¨çš„å¼‚æ­¥è¿½åŠ å‡½æ•°<code class="highlighter-rouge">fs.appendFile(path, data[, options], callback)</code></p>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">fs</span><span class="p">.</span><span class="nx">appendFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">message.txt</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">è¿½åŠ çš„æ•°æ®</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">æ•°æ®å·²è¿½åŠ åˆ°æ–‡ä»¶</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>å¦‚æœ options æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™å®ƒæŒ‡å®šå­—ç¬¦ç¼–ç ï¼š
<code class="highlighter-rouge">fs.appendFile('message.txt', 'è¿½åŠ çš„æ•°æ®', 'utf8', callback);</code></p>

<h2 id="æˆªå–æ–‡ä»¶å°†æ–‡ä»¶åªä¿ç•™å‰nä¸ªå­—èŠ‚">æˆªå–æ–‡ä»¶ï¼ˆå°†æ–‡ä»¶åªä¿ç•™å‰nä¸ªå­—èŠ‚ï¼‰</h2>
<p><code class="highlighter-rouge">fs.ftruncate(fd[, len], callback)</code>
å‚æ•°è¯´æ˜ï¼š</p>

<ul>
  <li>
    <p>fdï¼šé€šè¿‡ fs.open() æ–¹æ³•è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p>
  </li>
  <li>
    <p>lenï¼šæ–‡ä»¶å†…å®¹æˆªå–çš„é•¿åº¦ï¼Œé»˜è®¤ä¸º 0ã€‚</p>
  </li>
  <li>callbackï¼šé™¤äº†å¯èƒ½çš„å¼‚å¸¸ï¼Œå®Œæˆå›è°ƒæ²¡æœ‰å…¶ä»–å‚æ•°ã€‚
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">./1.txt</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">r+</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">fd</span><span class="p">){</span><span class="c1">//æ³¨æ„è¿™é‡Œå¿…é¡»æ˜¯r+å±æ€§ï¼Œå¦åˆ™æ— æ³•æˆªå–</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
      <span class="k">throw</span> <span class="nx">err</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">ftruncate</span><span class="p">(</span><span class="nx">fd</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>

          <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">./1.txt</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">data</span><span class="p">){</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
          <span class="p">})</span>
      <span class="p">})</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <h2 id="åˆ é™¤æ–‡ä»¶">åˆ é™¤æ–‡ä»¶</h2>
    <p><code class="highlighter-rouge">fs.unlink(path, callback)</code>
å‚æ•°è¯´æ˜ï¼š</p>
  </li>
  <li>
    <p>path:æ–‡ä»¶è·¯å¾„ã€‚</p>
  </li>
  <li>callback: é™¤äº†å¯èƒ½çš„å¼‚å¸¸ï¼Œå®Œæˆå›è°ƒæ²¡æœ‰å…¶ä»–å‚æ•°ã€‚
    <h2 id="ä¿®æ”¹æ–‡ä»¶å">ä¿®æ”¹æ–‡ä»¶å</h2>
    <p><code class="highlighter-rouge">fs.rename(oldPath, newPath, callback)</code>
å‚æ•°è¯´æ˜ï¼š</p>
  </li>
  <li>
    <p>oldPath:åŸæ¥çš„æ–‡ä»¶åå­—ã€‚</p>
  </li>
  <li>
    <p>newPathï¼šæ–°çš„æ–‡ä»¶åå­—ã€‚</p>
  </li>
  <li>callbackï¼šå›è°ƒå‡½æ•°ï¼Œé™¤äº†å¯èƒ½çš„å¼‚å¸¸ï¼Œå®Œæˆå›è°ƒæ²¡æœ‰å…¶ä»–å‚æ•°ã€‚
    <h2 id="ç›®å½•æ“ä½œ">ç›®å½•æ“ä½œ</h2>
    <h3 id="æ–°å»ºç›®å½•">æ–°å»ºç›®å½•</h3>
    <p><code class="highlighter-rouge">fs.mkdir(path[, options], callback)</code>
å‚æ•°è¯´æ˜ï¼š</p>
  </li>
  <li>
    <p>pathï¼šæ–‡ä»¶è·¯å¾„(å)ã€‚</p>
  </li>
  <li>
    <p>optionsï¼šæœ‰ä¸¤ä¸ªå‚æ•°ã€‚recursive è¡¨ç¤ºæ˜¯å¦ä»¥é€’å½’çš„æ–¹å¼åˆ›å»ºç›®å½•ï¼Œé»˜è®¤ä¸º falseã€‚mode è®¾ç½®ç›®å½•æƒé™ï¼ŒWindows ä¸Šä¸æ”¯æŒã€‚é»˜è®¤ä¸º 0o777ã€‚</p>
  </li>
  <li>callbackï¼šå›è°ƒå‡½æ•°ï¼Œé™¤äº†å¯èƒ½çš„å¼‚å¸¸ï¼Œå®Œæˆå›è°ƒæ²¡æœ‰å…¶ä»–å‚æ•°ã€‚</li>
</ul>

<h3 id="è¯»å–ç›®å½•">è¯»å–ç›®å½•</h3>
<p><code class="highlighter-rouge">fs.readdir(path[, options], callback)</code>
å‚æ•°è¯´æ˜ï¼š</p>

<ul>
  <li>
    <p>pathï¼šæ–‡ä»¶è·¯å¾„ã€‚</p>
  </li>
  <li>
    <p>optionsï¼šæœ‰ä¸¤ä¸ªå‚æ•° encodingï¼ŒwithFileTypesã€‚encoding é»˜è®¤å€¼ä¸º â€˜utf8â€™ï¼ŒwithFileTypes é»˜è®¤å€¼ä¸º falseã€‚</p>
  </li>
  <li>
    <p>callback - å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°å¸¦æœ‰ä¸¤ä¸ªå‚æ•° err, filesã€‚err ä¸ºé”™è¯¯ä¿¡æ¯ï¼Œfiles ä¸ºç›®å½•ä¸‹çš„æ–‡ä»¶æ•°ç»„åˆ—è¡¨ã€‚
<img src="http://ww1.sinaimg.cn/large/007dh5vlly1g5ea0oeoe1j30rb0g8761.jpg" alt="" /></p>
    <h3 id="åˆ é™¤ç›®å½•">åˆ é™¤ç›®å½•</h3>
    <p><code class="highlighter-rouge">fs.rmdir(path, callback)</code></p>
  </li>
</ul>

<h1 id="nodejsäº‹ä»¶">Node.jsäº‹ä»¶</h1>

<p>å¤§å¤šæ•° Node.js æ ¸å¿ƒ API æ„å»ºäºæƒ¯ç”¨çš„å¼‚æ­¥äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œå…¶ä¸­æŸäº›ç±»å‹çš„å¯¹è±¡ï¼ˆåˆç§°è§¦å‘å™¨ï¼ŒEmitterï¼‰ä¼šè§¦å‘å‘½åäº‹ä»¶æ¥è°ƒç”¨å‡½æ•°ï¼ˆåˆç§°ç›‘å¬å™¨ï¼ŒListenerï¼‰ã€‚æ¯”å¦‚ï¼šfs.readStream æ‰“å¼€æ–‡ä»¶æ—¶ä¼šå‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚å¯ä»¥é€šè¿‡ require(â€œeventsâ€); è·å¾— event æ¨¡å—ã€‚é€šå¸¸ï¼Œäº‹ä»¶åé‡‡ç”¨â€œé©¼å³°å¼â€(å³å•è¯é¦–å­—æ¯å¤§å†™ï¼Œå…¶ä»–å­—æ¯å°å†™)å‘½åæ–¹å¼ã€‚</p>

<h2 id="eventemitter">EventEmitter</h2>
<p>æ‰€æœ‰èƒ½è§¦å‘äº‹ä»¶çš„å¯¹è±¡éƒ½æ˜¯ EventEmitter ç±»çš„å®ä¾‹ã€‚è¿™äº›å¯¹è±¡æœ‰ä¸€ä¸ª eventEmitter.on() å‡½æ•°ï¼Œç”¨äºå°†ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ç»‘å®šåˆ°å‘½åäº‹ä»¶ä¸Šã€‚å½“ EventEmitter å¯¹è±¡è§¦å‘ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œæ‰€æœ‰ç»‘å®šåœ¨è¯¥äº‹ä»¶ä¸Šçš„å‡½æ•°éƒ½ä¼šè¢«åŒæ­¥åœ°è°ƒç”¨ã€‚
** EventEmitterç±»è·å–**</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c1">// å¼•å…¥ events æ¨¡å—</span>
<span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">events</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// åˆ›å»º eventEmitter å¯¹è±¡</span>
<span class="kd">var</span> <span class="nx">eventEmitter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">events</span><span class="p">.</span><span class="nx">EventEmitter</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="æ·»åŠ ç›‘å¬å™¨">æ·»åŠ ç›‘å¬å™¨</h3>
<p><code class="highlighter-rouge">emitter.on(eventName, listener)</code>
ä½¿ç”¨ emitter.on(eventName, listener) æ–¹æ³•ä¸ºæŒ‡å®šäº‹ä»¶æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ã€‚æ·»åŠ  listener å‡½æ•°åˆ°åä¸º eventName çš„äº‹ä»¶çš„ç›‘å¬å™¨æ•°ç»„çš„æœ«å°¾ã€‚</p>
<blockquote>
  <p>åˆ«å   emitter.addListener(eventName, listener)</p>
</blockquote>

<p>æ³¨æ„ï¼Œ<strong>è¿™ç§æ³¨å†Œç›‘å¬å™¨çš„æ–¹æ³•å°†ç›‘å¬å™¨ä¸€ç›´ä¿ç•™åœ¨å†…å­˜ä¸­</strong>
<img src="http://ww1.sinaimg.cn/large/007dh5vlly1g5dkupxxjfj30z70h6ac3.jpg" alt="" /></p>

<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
  <li>eventNameï¼šäº‹ä»¶åç§°ï¼Œstring ç±»å‹ã€‚</li>
  <li>listenerï¼šå›è°ƒå‡½æ•°ã€‚
<strong>ç¤ºä¾‹</strong>
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="c1">//å¼•å…¥ events æ¨¡å—</span>
<span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">events</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// åˆ›å»º emitter å¯¹è±¡</span>
<span class="kd">var</span> <span class="nx">emitter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">events</span><span class="p">.</span><span class="nx">EventEmitter</span><span class="p">();</span>
<span class="c1">//ä¸º connection äº‹ä»¶æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">å·²è¿æ¥</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">//ä¸€ç§’åè°ƒç”¨ç›‘å¬å™¨</span>
<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">emitter</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š
<img src="http://ww1.sinaimg.cn/large/007dh5vlly1g5c8b4xxweg30y20gw0u0.gif" alt="" /></p>
  </li>
</ul>

<p>å…¶åŸç†æ˜¯<code class="highlighter-rouge">emitter</code>å¯¹è±¡ç»™<code class="highlighter-rouge">connection</code>äº‹ä»¶æ³¨å†Œäº†ç›‘å¬å™¨ï¼Œç”¨<strong>setTimeout</strong>å‡½æ•°1000æ¯«ç§’åå‘<code class="highlighter-rouge">emitter</code>å¯¹è±¡å‘é€äº‹ä»¶<code class="highlighter-rouge">connection</code>ï¼Œæ­¤æ—¶è°ƒç”¨å®ƒçš„ç›‘å¬å™¨ã€‚<code class="highlighter-rouge">emit</code>æ–¹æ³•å°±æ˜¯å‘é€äº‹ä»¶çš„ã€‚
ä½¿ç”¨<code class="highlighter-rouge"> emitter.emit(eventName[, ...args]) </code>æŒ‰ç…§ç›‘å¬å™¨æ³¨å†Œçš„é¡ºåºï¼ŒåŒæ­¥åœ°è°ƒç”¨æ¯ä¸ªæ³¨å†Œåˆ°åä¸º<code class="highlighter-rouge"> eventName </code>çš„äº‹ä»¶çš„ç›‘å¬å™¨ï¼Œå¹¶ä¼ å…¥æä¾›çš„å‚æ•°ã€‚å¦‚æœäº‹ä»¶æœ‰æ³¨å†Œç›‘å¬è¿”å› <strong>true</strong>ï¼Œå¦åˆ™è¿”å› <strong>false</strong>ã€‚</p>

<p>å‚æ•°è¯´æ˜ï¼š</p>

<ul>
  <li>eventName ï¼šäº‹ä»¶åç§°</li>
  <li>argsï¼šä¼ é€’çš„å‚æ•°ï¼Œå¤šä¸ªï¼Œç±»å‹ä¸ºä»»æ„ã€‚</li>
</ul>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹ä»¶ç›‘å¬å™¨ä¼šæŒ‰ç…§æ·»åŠ çš„é¡ºåºä¾æ¬¡è°ƒç”¨ã€‚<code class="highlighter-rouge">emitter.prependListener()</code> æ–¹æ³•å¯ç”¨äºå°†äº‹ä»¶ç›‘å¬å™¨æ·»åŠ åˆ°ç›‘å¬å™¨æ•°ç»„çš„å¼€å¤´ã€‚</p>

<p>ä¾‹å¦‚åœ¨<code class="highlighter-rouge">setTimeout</code>å‰æ·»åŠ ï¼Œ<code class="highlighter-rouge">emitter.prependListener('connection',() =&gt;console.log('hh'));</code>ï¼Œå°†ä¼šå…ˆæ‰“å°<strong>hh</strong>,å†æ‰“å°<strong>å·²è¿æ¥</strong>ã€‚</p>

<hr />
<p><code class="highlighter-rouge"> eventEmitter.once(eventName, listener) </code></p>

<p>æ­¤å¯ä»¥æ³¨å†Œæœ€å¤šå¯è°ƒç”¨ä¸€æ¬¡çš„ç›‘å¬å™¨ã€‚ å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œç›‘å¬å™¨ä¼šè¢«æ³¨é”€ï¼Œç„¶åå†è°ƒç”¨ã€‚
<img src="http://ww1.sinaimg.cn/large/007dh5vlly1g5dky9oqukj30vg0d0wg2.jpg" alt="" />
è€Œ<code class="highlighter-rouge">emitter.prependOnceListener()</code> æ–¹æ³•å¯ç”¨äºå°†äº‹ä»¶ç›‘å¬å™¨æ·»åŠ åˆ°ç›‘å¬å™¨æ•°ç»„çš„å¼€å¤´ã€‚</p>

<h3 id="ç§»é™¤ç›‘å¬å™¨">ç§»é™¤ç›‘å¬å™¨</h3>

<p><code class="highlighter-rouge">emitter.removeListener(eventName, listener)</code>
å‚æ•°è¯´æ˜ï¼š</p>

<ul>
  <li>eventName äº‹ä»¶åç§°</li>
  <li>listener ç›‘å¬å™¨ä¹Ÿå°±æ˜¯å›è°ƒå‡½æ•°åç§°ã€‚</li>
</ul>

<blockquote>
  <p>æ³¨ï¼šremoveListener() æœ€å¤šåªä¼šä»ç›‘å¬å™¨æ•°ç»„ä¸­ç§»é™¤ä¸€ä¸ªç›‘å¬å™¨ã€‚æˆ‘ä»¬å¯ä»¥å¤šæ¬¡è°ƒç”¨ removeListener() çš„æ–¹å¼æ¥ä¸€ä¸ªä¸ªçš„ç§»é™¤æˆ‘ä»¬éœ€è¦ç§»é™¤æ‰çš„ç›‘å¬å™¨ã€‚</p>
</blockquote>

<blockquote>
  <p>emitter.off(eventName, listener)æ˜¯emitter.removeListener()çš„åˆ«å</p>
</blockquote>

<p><code class="highlighter-rouge">emitter.removeAllListeners([eventName])</code>
ä½¿ç”¨ emitter.removeAllListeners([eventName]) ç§»é™¤å…¨éƒ¨ç›‘å¬å™¨æˆ–æŒ‡å®šçš„ eventName äº‹ä»¶çš„ç›‘å¬å™¨ã€‚</p>

<h3 id="è®¾ç½®ç›‘å¬å™¨æœ€å¤§ç»‘å®šæ•°">è®¾ç½®ç›‘å¬å™¨æœ€å¤§ç»‘å®šæ•°</h3>

<p><code class="highlighter-rouge">emitter.setMaxListeners(n)</code>
é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸ºç‰¹å®šäº‹ä»¶æ·»åŠ äº†è¶…è¿‡ 10 ä¸ªç›‘å¬å™¨ï¼Œåˆ™ EventEmitter ä¼šæ‰“å°ä¸€ä¸ªè­¦å‘Šï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬å‘ç°å†…å­˜æ³„éœ²ã€‚æ˜¾ç„¶å®é™…ç¼–ç ä¸­å¹¶ä¸æ˜¯æ‰€æœ‰çš„äº‹ä»¶éƒ½è¦é™åˆ¶ 10 ä¸ªç›‘å¬å™¨ã€‚ emitter.setMaxListeners() æ–¹æ³•å¯ä»¥ä¸ºæŒ‡å®šçš„ EventEmitter å®ä¾‹ä¿®æ”¹é™åˆ¶ã€‚å½“å€¼è®¾ä¸º Infinityï¼ˆæˆ– 0ï¼‰è¡¨ç¤ºä¸é™åˆ¶ç›‘å¬å™¨çš„æ•°é‡ã€‚</p>

<h3 id="æŸ¥çœ‹äº‹ä»¶ç»‘å®šçš„ç›‘å¬å™¨ä¸ªæ•°">æŸ¥çœ‹äº‹ä»¶ç»‘å®šçš„ç›‘å¬å™¨ä¸ªæ•°</h3>

<p><code class="highlighter-rouge">emitter.listenerCount(eventName)</code></p>

<h2 id="erroräº‹ä»¶">erroräº‹ä»¶</h2>

<p>å½“ EventEmitter å®ä¾‹å‡ºé”™æ—¶ï¼Œåº”è¯¥è§¦å‘ â€˜errorâ€™ äº‹ä»¶ã€‚</p>

<p>å¦‚æœæ²¡æœ‰ä¸º â€˜errorâ€™ äº‹ä»¶æ³¨å†Œç›‘å¬å™¨ï¼Œåˆ™å½“ â€˜errorâ€™ äº‹ä»¶è§¦å‘æ—¶ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€æ‰“å°å †æ ˆè·Ÿè¸ªã€å¹¶é€€å‡º Node.js è¿›ç¨‹ã€‚</p>

<p>é€šå¸¸æˆ‘ä»¬è¦ä¸ºä¼šè§¦å‘ error äº‹ä»¶çš„å¯¹è±¡è®¾ç½®ç›‘å¬å™¨ï¼Œé¿å…é‡åˆ°é”™è¯¯åæ•´ä¸ªç¨‹åºå´©æºƒã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">events</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">events</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">emitter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">events</span><span class="p">.</span><span class="nx">EventEmitter</span><span class="p">();</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,(</span><span class="nx">err</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">é”™è¯¯</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="nodejsæ¡†æ¶expressæ¡†æ¶">Node.jsæ¡†æ¶â€”Expressæ¡†æ¶</h1>

<p>å¯ä»¥é€šè¿‡ Express å¯ä»¥å¿«é€Ÿåœ°æ­å»ºä¸€ä¸ªå®Œæ•´åŠŸèƒ½çš„ç½‘ç«™ã€‚ä½¿ç”¨æ¡†æ¶çš„ç›®çš„å°±æ˜¯è®©æˆ‘ä»¬æ›´åŠ ä¸“æ³¨äºä¸šåŠ¡ï¼Œè€Œä¸æ˜¯åº•å±‚ç»†èŠ‚ã€‚
<strong>ç¬¬ä¸€ä¸ªç¤ºä¾‹</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">æœåŠ¡å™¨å¯åŠ¨äº†</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="è·¯ç”±">è·¯ç”±</h2>
<p><code class="highlighter-rouge">app.method(path, handler)</code>
è·¯ç”±<strong>ç”¨äº</strong>ç¡®å®šåº”ç”¨ç¨‹åºå¦‚ä½•å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒåŒ…å«ä¸€ä¸ª URIï¼ˆè·¯å¾„ï¼‰å’Œä¸€ä¸ªç‰¹å®šçš„ HTTP è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POST ç­‰ï¼‰ã€‚</p>
<blockquote>
  <p>æ³¨ï¼šapp æ˜¯ express çš„å®ä¾‹ï¼Œmethod æ˜¯æŒ‡ HTTP è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POST ç­‰ï¼‰ï¼Œpath æ˜¯æŒ‡æœåŠ¡å™¨ä¸Šçš„è·¯å¾„ï¼Œhandler æ˜¯æŒ‡è·¯ç”±åŒ¹é…æ—¶æ‰§è¡Œçš„å‡½æ•°ã€‚</p>
</blockquote>

<p>æ —å­</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="c1">// GET è¯·æ±‚</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">GET è¯·æ±‚</span><span class="dl">"</span><span class="p">);</span>
   <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Helloï¼Œæˆ‘æ˜¯GETè¯·æ±‚</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})</span>

<span class="c1">// POST è¯·æ±‚</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">POST è¯·æ±‚</span><span class="dl">"</span><span class="p">);</span>
   <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Helloï¼Œæˆ‘æ˜¯ POST è¯·æ±‚</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})</span>

<span class="c1">// /index å“åº”indexé¡µé¢ GET è¯·æ±‚</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/index</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">/å“åº”indexé¡µé¢ GET è¯·æ±‚</span><span class="dl">"</span><span class="p">);</span>
   <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Helloï¼Œæˆ‘æ˜¯ index é¡µé¢ GET è¯·æ±‚</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="é™æ€æ–‡ä»¶">é™æ€æ–‡ä»¶</h2>
<p>å…¬å¼€<code class="highlighter-rouge">public</code>ç›®å½•ï¼Œç„¶åè®¿é—®å…¶ä¸­çš„èµ„æº
<code class="highlighter-rouge">app.use('/public/', express.static('./public/'))</code>
æˆ–è€…</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">æœåŠ¡å™¨å¯åŠ¨äº†</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="express-æ¡†æ¶å¤„ç†postè¯·æ±‚">Express æ¡†æ¶å¤„ç†POSTè¯·æ±‚</h2>

<!-- tab 1.js -->
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">body-parser</span><span class="dl">'</span><span class="p">)</span>
  <span class="c1">//åˆ›å»º application/x-www-form-urlencoded è§£æ</span>
<span class="kd">var</span> <span class="nx">urlencodedParser</span> <span class="o">=</span> <span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span><span class="na">extended</span><span class="p">:</span> <span class="kc">false</span><span class="p">})</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//ä¼ é€æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ -ä¼šè‡ªåŠ¨æ ¹æ®æ–‡ä»¶extensionè®¾å®šContent-Type</span>
    <span class="c1">//ä¹Ÿå¯ä»¥ç”¨å‰é¢çš„ art-template æ¨¡æ¿å¼•æ“</span>
    <span class="c1">//å¿…é¡»æœ‰</span>
   <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">1.html</span><span class="dl">"</span> <span class="p">);</span>
<span class="p">})</span>
<span class="c1">//è·å– URLç¼–ç çš„è¯·æ±‚ä½“</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/post_test</span><span class="dl">'</span><span class="p">,</span><span class="nx">urlencodedParser</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">stuNum</span><span class="dl">"</span><span class="p">:</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">stuNum</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">stuNam</span><span class="dl">"</span><span class="p">:</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">stuNam</span>
    <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">response</span><span class="p">))</span>
<span class="p">})</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="dl">'</span><span class="s1">8080</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">start</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<!-- endtab -->
<!-- tab 1.html -->
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>

    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/post_test"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
            å­¦å·: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"stuNum"</span><span class="nt">&gt;&lt;br</span> <span class="nt">/&gt;</span>
            å§“å: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"stuNam"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"æäº¤"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<!-- endtab -->

<p>è¿™é‡Œç”¨åˆ°äº†<code class="highlighter-rouge">body-parser</code>è¿™ä¸ªHTTP<strong>è¯·æ±‚ä½“è§£æä¸­é—´ä»¶</strong>ï¼Œç”¨è¿™ä¸ªæ¨¡å—å¯ä»¥è§£æJSONã€Rawã€æ–‡æœ¬ã€URL-encodedæ ¼å¼çš„è¯·æ±‚ä½“</p>

<ol>
  <li>bodyParser.json(options): è§£æjsonæ•°æ®</li>
  <li>bodyParser.raw(options): è§£æäºŒè¿›åˆ¶æ ¼å¼(Bufferæµæ•°æ®)</li>
  <li>bodyParser.text(options): è§£ææ–‡æœ¬æ•°æ®</li>
  <li>bodyParser.urlencoded(options): è§£æUTF-8çš„ç¼–ç çš„æ•°æ®ã€‚</li>
</ol>

<p>optionå¯é€‰å¯¹è±¡:</p>

<!-- tab bodyParser.json()-->

<ol>
  <li>inflate - è®¾ç½®ä¸ºtrueæ—¶ï¼Œdeflateå‹ç¼©æ•°æ®ä¼šè¢«è§£å‹ç¼©ï¼›è®¾ç½®ä¸ºtrueæ—¶ï¼Œdeflateå‹ç¼©æ•°æ®ä¼šè¢«æ‹’ç»ã€‚é»˜è®¤ä¸ºtrueã€‚</li>
  <li>limit - è®¾ç½®è¯·æ±‚çš„æœ€å¤§æ•°æ®é‡ã€‚é»˜è®¤ä¸ºâ€™100kbâ€™</li>
  <li>reviver - ä¼ é€’ç»™JSON.parse()æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯¦è§JSON.parse()</li>
  <li>strict - è®¾ç½®ä¸ºtrueæ—¶ï¼Œä»…ä¼šè§£æArrayå’ŒObjectä¸¤ç§æ ¼å¼ï¼›è®¾ç½®ä¸ºfalseä¼šè§£ææ‰€æœ‰JSON.parseæ”¯æŒçš„æ ¼å¼ã€‚é»˜è®¤ä¸ºtrue</li>
  <li>type - è¯¥é€‰é¡¹ç”¨äºè®¾ç½®ä¸ºæŒ‡å®šMIMEç±»å‹çš„æ•°æ®ä½¿ç”¨å½“å‰è§£æä¸­é—´ä»¶ã€‚è¿™ä¸ªé€‰é¡¹å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–æ˜¯å­—ç¬¦ä¸²ï¼Œå½“æ˜¯å­—ç¬¦ä¸²æ˜¯ä¼šä½¿ç”¨type-isæ¥æŸ¥æ‰¾MIMIç±»å‹ï¼›å½“ä¸ºå‡½æ•°æ˜¯ï¼Œä¸­é—´ä»¶ä¼šé€šè¿‡fn(req)æ¥è·å–å®é™…å€¼ã€‚é»˜è®¤ä¸ºapplication/jsonã€‚</li>
  <li>verify - è¿™ä¸ªé€‰é¡¹ä»…åœ¨verify(req, res, buf, encoding)æ—¶å—æ”¯æŒ
<!-- endtab -->
<!-- tab bodyParser.raw()--></li>
  <li>inflate - è®¾ç½®ä¸ºtrueæ—¶ï¼Œdeflateå‹ç¼©æ•°æ®ä¼šè¢«è§£å‹ç¼©ï¼›è®¾ç½®ä¸ºtrueæ—¶ï¼Œdeflateå‹ç¼©æ•°æ®ä¼šè¢«æ‹’ç»ã€‚é»˜è®¤ä¸ºtrueã€‚</li>
  <li>limit - è®¾ç½®è¯·æ±‚çš„æœ€å¤§æ•°æ®é‡ã€‚é»˜è®¤ä¸ºâ€™100kbâ€™</li>
  <li>type - è¯¥é€‰é¡¹ç”¨äºè®¾ç½®ä¸ºæŒ‡å®šMIMEç±»å‹çš„æ•°æ®ä½¿ç”¨å½“å‰è§£æä¸­é—´ä»¶ã€‚è¿™ä¸ªé€‰é¡¹å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–æ˜¯å­—ç¬¦ä¸²ï¼Œå½“æ˜¯å­—ç¬¦ä¸²æ˜¯ä¼šä½¿ç”¨type-isæ¥æŸ¥æ‰¾MIMIç±»å‹ï¼›å½“ä¸ºå‡½æ•°æ˜¯ï¼Œä¸­é—´ä»¶ä¼šé€šè¿‡fn(req)æ¥è·å–å®é™…å€¼ã€‚é»˜è®¤ä¸ºapplication/octet-streamã€‚</li>
  <li>verify - è¿™ä¸ªé€‰é¡¹ä»…åœ¨verify(req, res, buf, encoding)æ—¶å—æ”¯æŒ
<!-- endtab -->
<!-- tab bodyParser.text()--></li>
  <li>defaultCharset - å¦‚æœContent-Typeåæ²¡æœ‰æŒ‡å®šç¼–ç æ—¶ï¼Œä½¿ç”¨æ­¤ç¼–ç ã€‚é»˜è®¤ä¸ºâ€™utf-8â€™</li>
  <li>inflate - è®¾ç½®ä¸ºtrueæ—¶ï¼Œdeflateå‹ç¼©æ•°æ®ä¼šè¢«è§£å‹ç¼©ï¼›è®¾ç½®ä¸ºtrueæ—¶ï¼Œdeflateå‹ç¼©æ•°æ®ä¼šè¢«æ‹’ç»ã€‚é»˜è®¤ä¸ºtrueã€‚</li>
  <li>limit - è®¾ç½®è¯·æ±‚çš„æœ€å¤§æ•°æ®é‡ã€‚é»˜è®¤ä¸ºâ€™100kbâ€™</li>
  <li>type - è¯¥é€‰é¡¹ç”¨äºè®¾ç½®ä¸ºæŒ‡å®šMIMEç±»å‹çš„æ•°æ®ä½¿ç”¨å½“å‰è§£æä¸­é—´ä»¶ã€‚è¿™ä¸ªé€‰é¡¹å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–æ˜¯å­—ç¬¦ä¸²ï¼Œå½“æ˜¯å­—ç¬¦ä¸²æ˜¯ä¼šä½¿ç”¨type-isæ¥æŸ¥æ‰¾MIMIç±»å‹ï¼›å½“ä¸ºå‡½æ•°æ˜¯ï¼Œä¸­é—´ä»¶ä¼šé€šè¿‡fn(req)æ¥è·å–å®é™…å€¼ã€‚é»˜è®¤ä¸ºapplication/octet-streamã€‚</li>
  <li>verify - è¿™ä¸ªé€‰é¡¹ä»…åœ¨verify(req, res, buf, encoding)æ—¶å—æ”¯æŒ
<!-- endtab -->
<!-- tab bodyParser.urlencoded()--></li>
  <li>extended - å½“è®¾ç½®ä¸ºfalseæ—¶ï¼Œä¼šä½¿ç”¨querystringåº“è§£æURLç¼–ç çš„æ•°æ®ï¼›å½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œä¼šä½¿ç”¨qsåº“è§£æURLç¼–ç çš„æ•°æ®ã€‚åæ²¡æœ‰æŒ‡å®šç¼–ç æ—¶ï¼Œä½¿ç”¨æ­¤ç¼–ç ã€‚é»˜è®¤ä¸ºtrue</li>
  <li>inflate - è®¾ç½®ä¸ºtrueæ—¶ï¼Œdeflateå‹ç¼©æ•°æ®ä¼šè¢«è§£å‹ç¼©ï¼›è®¾ç½®ä¸ºtrueæ—¶ï¼Œdeflateå‹ç¼©æ•°æ®ä¼šè¢«æ‹’ç»ã€‚é»˜è®¤ä¸ºtrueã€‚</li>
  <li>limit - è®¾ç½®è¯·æ±‚çš„æœ€å¤§æ•°æ®é‡ã€‚é»˜è®¤ä¸ºâ€™100kbâ€™</li>
  <li>parameterLimit - ç”¨äºè®¾ç½®URLç¼–ç å€¼çš„æœ€å¤§æ•°æ®ã€‚é»˜è®¤ä¸º1000</li>
  <li>type - è¯¥é€‰é¡¹ç”¨äºè®¾ç½®ä¸ºæŒ‡å®šMIMEç±»å‹çš„æ•°æ®ä½¿ç”¨å½“å‰è§£æä¸­é—´ä»¶ã€‚è¿™ä¸ªé€‰é¡¹å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–æ˜¯å­—ç¬¦ä¸²ï¼Œå½“æ˜¯å­—ç¬¦ä¸²æ˜¯ä¼šä½¿ç”¨type-isæ¥æŸ¥æ‰¾MIMIç±»å‹ï¼›å½“ä¸ºå‡½æ•°æ˜¯ï¼Œä¸­é—´ä»¶ä¼šé€šè¿‡fn(req)æ¥è·å–å®é™…å€¼ã€‚é»˜è®¤ä¸ºapplication/octet-streamã€‚</li>
  <li>verify - è¿™ä¸ªé€‰é¡¹ä»…åœ¨verify(req, res, buf, encoding)æ—¶å—æ”¯æŒ
<!-- endtab --></li>
</ol>
:ET